# 偏移量工具集

本工具集包含三个主要工具，用于测试、比较和验证游戏内存偏移量，帮助您在游戏更新后快速识别和修复偏移量问题。

## 工具概述

1. **TestOffsets** - 偏移量测试工具
   - 测试当前偏移量是否正确工作
   - 验证关键数据是否可读且有效
   - 生成详细的测试报告

2. **CompareOffsets** - 偏移量比较工具
   - 比较两组偏移量之间的差异
   - 识别游戏更新后变化的偏移量
   - 生成差异报告

3. **ValidateOffsets** - 偏移量验证工具
   - 验证偏移量是否符合预期规则
   - 检查数据类型和范围是否正确
   - 提供分类验证功能

## 编译方法

使用提供的Makefile编译所有工具：

```bash
# 编译所有工具
make all

# 或者单独编译
make test-offsets      # 编译偏移量测试工具
make compare-offsets   # 编译偏移量比较工具
```

编译后的可执行文件将位于 `bin/` 目录下。

## 使用方法

### 偏移量测试工具

```bash
# 运行偏移量测试工具
./bin/TestOffsets
```

该工具将：
1. 初始化内存管理器
2. 测试所有定义的偏移量
3. 生成测试报告 (`offset_test_report.txt`)
4. 保存当前偏移量 (`current_offsets.h`)

测试报告包含：
- 总测试数量
- 通过/失败的测试数量
- 成功率
- 各类别的详细测试结果

### 偏移量比较工具

```bash
# 比较两个偏移量文件
./bin/CompareOffsets old_offsets.h new_offsets.h
```

该工具将：
1. 加载两个偏移量文件
2. 比较偏移量值
3. 生成比较报告 (`offset_comparison_report.txt`)

比较报告包含：
- 新增的偏移量
- 删除的偏移量
- 变化的偏移量

## 游戏更新后的工作流程

当《英雄联盟》游戏更新后，偏移量可能会发生变化。以下是更新偏移量的推荐工作流程：

1. **保存当前偏移量**
   ```bash
   # 在游戏更新前，保存当前偏移量
   ./bin/TestOffsets
   cp current_offsets.h offsets_before_update.h
   ```

2. **游戏更新后**
   ```bash
   # 运行偏移量测试工具，检查哪些偏移量失效
   ./bin/TestOffsets
   ```

3. **比较偏移量变化**
   ```bash
   # 比较更新前后的偏移量
   ./bin/CompareOffsets offsets_before_update.h current_offsets.h
   ```

4. **更新偏移量**
   - 根据测试报告和比较报告，更新 `Core/Offsets.h` 中失效的偏移量
   - 重新运行测试工具验证更新后的偏移量

## 偏移量测试原理

偏移量测试工具通过以下方式验证偏移量的正确性：

1. **获取游戏基址**：通过内存管理器获取游戏模块的基址
2. **读取关键数据**：使用定义的偏移量读取游戏内存中的数据
3. **验证数据有效性**：检查读取的数据是否在合理范围内
   - 指针值是否为有效地址
   - 数值是否在预期范围内
   - 字符串是否有效
4. **生成报告**：记录测试结果和详细信息

## 偏移量比较原理

偏移量比较工具通过以下方式检测偏移量变化：

1. **解析偏移量文件**：读取并解析两个偏移量文件
2. **构建偏移量映射**：将偏移量组织为类别-名称到值的映射
3. **比较偏移量**：
   - 检查新增的偏移量
   - 检查删除的偏移量
   - 检查值发生变化的偏移量
4. **生成报告**：分类记录所有变化

## 注意事项

1. **游戏版本**：不同游戏版本的偏移量可能不同，确保使用与游戏版本匹配的偏移量
2. **权限**：运行这些工具需要管理员权限，因为它们需要读取游戏进程的内存
3. **游戏状态**：某些偏移量测试需要游戏处于特定状态（例如，在游戏中而不是在主菜单）
4. **反作弊**：使用这些工具时请注意游戏的反作弊系统，避免被封禁

## 扩展功能

这些工具可以进一步扩展，添加以下功能：

1. **自动更新**：自动从网络获取最新的偏移量
2. **偏移量扫描**：自动扫描内存查找偏移量
3. **版本管理**：管理不同游戏版本的偏移量
4. **GUI界面**：提供图形用户界面，方便使用
5. **插件系统**：支持插件扩展功能

## 故障排除

### 常见问题

1. **无法读取游戏内存**
   - 确保以管理员权限运行工具
   - 确保游戏正在运行
   - 检查游戏进程名称是否正确

2. **测试结果全部失败**
   - 检查游戏基址是否正确
   - 确认偏移量是否适用于当前游戏版本
   - 检查内存读取权限

3. **比较工具无法解析文件**
   - 确保偏移量文件格式正确
   - 检查文件路径是否正确
   - 确保文件存在且可读

### 调试方法

1. **启用详细输出**：修改代码添加更多调试信息
2. **单步调试**：使用调试器逐步执行代码
3. **内存检查**：使用内存查看工具验证内存内容
4. **日志记录**：添加日志记录功能，记录详细操作过程

## 贡献

欢迎提交问题报告和功能请求。如果您想贡献代码，请遵循以下步骤：

1. Fork 本项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 许可证

本项目采用 MIT 许可证。详情请参阅 LICENSE 文件。